#!/usr/bin/env python3
"""
股票清單生成器 - 生成台股180支股票清單
"""
import sys
import os
from pathlib import Path

# 添加路徑
current_dir = Path(__file__).parent
sys.path.insert(0, str(current_dir))
sys.path.insert(0, str(current_dir / "market_data_collector"))

def generate_taiwan_stock_list() -> list:
    """生成台股180支股票清單"""
    
    # 台股市值前180大股票（2024年版本）
    taiwan_top_180 = [
        # 超大型股 (市值前30)
        "2330",  # 台積電
        "2317",  # 鴻海
        "2454",  # 聯發科
        "2382",  # 廣達
        "2603",  # 長榮
        "3711",  # 日月光投控
        "2449",  # 京元電子
        "3037",  # 欣興
        "2308",  # 台達電
        "2395",  # 研華
        "5347",  # 世界
        "2486",  # 一詮
        "4919",  # 新唐
        "6187",  # 萬潤
        "2609",  # 陽明
        "3481",  # 群創
        "3019",  # 亞光
        "2379",  # 瑞昱
        "3231",  # 緯創
        "8064",  # 東捷
        "2356",  # 英業達
        "2882",  # 國泰金
        "2881",  # 富邦金
        "2880",  # 華南金
        "2886",  # 兆豐金
        "2885",  # 元大金
        "2884",  # 玉山金
        "2883",  # 開發金
        "2887",  # 台新金
        "2888",  # 新光金
        
        # 大型股 (31-60)
        "2889",  # 國票金
        "2890",  # 永豐金
        "2891",  # 中信金
        "2892",  # 第一金
        "5880",  # 合庫金
        "2834",  # 臺企銀
        "2836",  # 高雄銀
        "2838",  # 聯邦銀
        "2845",  # 遠東銀
        "2849",  # 安泰銀
        "1101",  # 台泥
        "1102",  # 亞泥
        "1216",  # 統一
        "1301",  # 台塑
        "1303",  # 南亞
        "1326",  # 台化
        "1402",  # 遠東新
        "1590",  # 亞德客-KY
        "1605",  # 華新
        "1717",  # 長興
        "2002",  # 中鋼
        "2027",  # 大成鋼
        "2105",  # 正新
        "2201",  # 裕隆
        "2207",  # 和泰車
        "2301",  # 光寶科
        "2303",  # 聯電
        "2324",  # 仁寶
        "2344",  # 華邦電
        "2347",  # 聯強
        
        # 中大型股 (61-90)
        "2351",  # 順德
        "2353",  # 宏碁
        "2354",  # 鴻準
        "2355",  # 敬鵬
        "2357",  # 華碩
        "2360",  # 致茂
        "2362",  # 藍天
        "2365",  # 昆盈
        "2367",  # 燿華
        "2368",  # 金像電
        "2369",  # 菱生
        "2371",  # 大同
        "2376",  # 技嘉
        "2408",  # 南亞科
        "2409",  # 友達
        "2412",  # 中華電
        "2474",  # 可成
        "2492",  # 華新科
        "2498",  # 宏達電
        "2542",  # 興富發
        "2547",  # 日勝生
        "2606",  # 裕民
        "2610",  # 華航
        "2615",  # 萬海
        "2618",  # 長榮航
        "2637",  # 慧洋-KY
        "2641",  # 正德
        "2727",  # 王品
        "2801",  # 彰銀
        "2823",  # 中壽
        
        # 中型股 (91-120)
        "2867",  # 三商壽
        "2912",  # 統一超
        "3008",  # 大立光
        "3029",  # 零壹
        "3034",  # 聯詠
        "3035",  # 智原
        "3036",  # 文曄
        "3041",  # 揚智
        "3043",  # 科風
        "3044",  # 健鼎
        "3045",  # 台灣大
        "3047",  # 訊舟
        "3048",  # 益登
        "3049",  # 和鑫
        "3050",  # 鈺德
        "3051",  # 力特
        "3052",  # 夆典
        "3054",  # 立德
        "3055",  # 蔚華科
        "3056",  # 總太
        "3057",  # 喬鼎
        "3058",  # 立德
        "3059",  # 華晶科
        "3060",  # 銘異
        "3061",  # 璨圓
        "3062",  # 建漢
        "3090",  # 日電貿
        "3094",  # 聯傑
        "3130",  # 一零四
        "3149",  # 正達
        
        # 中小型股 (121-150)
        "3164",  # 景岳
        "3189",  # 景碩
        "3209",  # 全科
        "3227",  # 原相
        "3231",  # 緯創
        "3257",  # 虹冠電
        "3264",  # 欣銓
        "3266",  # 昇陽
        "3296",  # 勝德
        "3305",  # 昇貿
        "3308",  # 聯德
        "3311",  # 閎暉
        "3312",  # 弘憶股
        "3321",  # 同泰
        "3338",  # 泰碩
        "3356",  # 奇偶
        "3376",  # 新日興
        "3380",  # 明泰
        "3383",  # 新世紀
        "3406",  # 玉晶光
        "3413",  # 京鼎
        "3416",  # 融程電
        "3419",  # 譁裕
        "3443",  # 創意
        "3454",  # 晶睿
        "3481",  # 群創
        "3515",  # 華擎
        "3518",  # 柏騰
        "3529",  # 力旺
        "3533",  # 嘉澤
        
        # 小型股 (151-180)
        "3545",  # 敦泰
        "3576",  # 聯合再生
        "3583",  # 辛耘
        "3588",  # 通嘉
        "3591",  # 艾笛森
        "3593",  # 力銘
        "3596",  # 智易
        "3661",  # 世芯-KY
        "3673",  # TPK-KY
        "3679",  # 新至陞
        "3682",  # 亞太電
        "3694",  # 海華
        "3701",  # 大眾控
        "3702",  # 大聯大
        "3703",  # 欣陸
        "3704",  # 合勤控
        "3705",  # 永信
        "3706",  # 神達
        "3708",  # 上緯投控
        "4904",  # 遠傳
        "4906",  # 正文
        "4915",  # 致伸
        "4919",  # 新唐
        "4938",  # 和碩
        "4958",  # 臻鼎-KY
        "4968",  # 立積
        "4976",  # 佳世達
        "4977",  # 眾達-KY
        "4999",  # 鑫禾
        "5269",  # 祥碩
        "5285"   # 界霖
    ]
    
    return taiwan_top_180


def save_stock_list_to_config():
    """將股票清單儲存到配置檔案"""
    try:
        from market_data_collector.utils import config
        
        stock_list = generate_taiwan_stock_list()
        
        # 更新配置檔案中的STOCK_IDS
        config_file = Path(__file__).parent / "market_data_collector" / "utils" / "config.py"
        
        if config_file.exists():
            with open(config_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # 找到STOCK_IDS的定義並替換
            import re
            pattern = r'STOCK_IDS\s*=\s*\[.*?\]'
            
            new_stock_ids = f"STOCK_IDS = {stock_list}"
            
            if re.search(pattern, content, re.DOTALL):
                content = re.sub(pattern, new_stock_ids, content, flags=re.DOTALL)
            else:
                # 如果找不到，在檔案末尾添加
                content += f"\n\n# 更新的股票清單\n{new_stock_ids}\n"
            
            with open(config_file, 'w', encoding='utf-8') as f:
                f.write(content)
            
            print(f"✅ 已更新股票清單到 {config_file}")
            print(f"📊 總共 {len(stock_list)} 支股票")
        else:
            print(f"❌ 找不到配置檔案: {config_file}")
            
    except Exception as e:
        print(f"❌ 更新配置檔案失敗: {e}")


def main():
    """主函數"""
    print("=== 台股180支股票清單生成器 ===")
    
    stock_list = generate_taiwan_stock_list()
    
    print(f"生成股票清單，共 {len(stock_list)} 支股票:")
    
    # 分組顯示
    for i in range(0, len(stock_list), 10):
        group = stock_list[i:i+10]
        print(f"  {i+1:3d}-{min(i+10, len(stock_list)):3d}: {', '.join(group)}")
    
    # 詢問是否要更新配置檔案
    choice = input("\n是否要更新到配置檔案？(y/N): ").strip().lower()
    if choice == 'y':
        save_stock_list_to_config()
    
    return stock_list


if __name__ == "__main__":
    main()